cmake_minimum_required(VERSION 3.14)
project(NoSpherA2 CXX C)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS ON)
if (MSVC)
    set(CMAKE_TRY_COMPILE_CONFIGURATION Release)
endif()
set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
set(BUILD_DIR ${CMAKE_SOURCE_DIR}/build)
set(DEBUG_DIR ${CMAKE_SOURCE_DIR}/build_debug)
set(CMAKE_INSTALL_PREFIX $ENV{HOME})
message(STATUS "Install prefix: ${CMAKE_INSTALL_PREFIX}")

if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME)
    option(BUILD_TESTING "Run tests" ON)
    option(FROM_SOURCE_DEPENDENCIES "BUILD EVERY DEPENDENCY FROM SOURCE" OFF)
    option(WINDOWS_CROSS_COMPILE "CROSS COMPILING TO WINDOWS" OFF)
    option(BUILD_OPENMP "Necessary if cross compiling from windows to Linux/Darwin" OFF)
    option(USE_VECTOR_INSTRUCTIONS "If you want to use vector instructions. Defaults to ON" ON)
    option(WITH_CLANG_TIDY "Enable clang tidy" OFF)
    set(ONEAPI_DIRECTORY $ENV{MKLROOT} CACHE STRING
        "Location of OneAPI. If empty and you didn't loaded modules or used a setvars.sh, OneAPI will be downloaded.")
    set(FAKE_HOME_TEST "ON" CACHE STRING
        "This is for testing the automatic install of MKL. It pretends the home directory is at /tmp/home.")
endif()

set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
include("${CMAKE_CURRENT_SOURCE_DIR}/cmake/CPM.cmake")
include("${CMAKE_CURRENT_SOURCE_DIR}/cmake/NOSTEST.cmake")
add_subdirectory(3rdparty EXCLUDE_FROM_ALL)
if (WITH_OCC)
    add_subdirectory(Src/occ)
endif ()

if (WITH_OCC)
    find_package(occ REQUIRED)
endif ()
add_subdirectory(Src)
enable_testing()
add_subdirectory(tests)
